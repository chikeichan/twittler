<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.3/moment.min.js"></script>
    <style>
    body {
      background-color: rgb(159, 213, 252);
    }

    div.message {
      background-color: white;
      margin-top: 5px;
      margin-left: auto ;
      margin-right: auto ;
      text-align: left;
      width: 60%;
      height: auto;
      border-radius: 5px;
      padding: 5px;
      box-shadow: 2px 2px rgb(76, 145, 203);
      display: none;
    }

    div.filter {
      background-color: white;
      margin-top: 5px;
      margin-left: auto ;
      margin-right: auto ;
      text-align: left;
      width: 60%;
      height: auto;
      border-radius: 5px;
      padding: 5px;
      box-shadow: 2px 2px rgb(76, 145, 203);
      display: none;
    }

    p#filteredname {
      display: block;
      font-family: tahoma;
      font-weight: bold;
      text-decoration: underline;
    }

    p#filter {
      font-family: arial;
      font-size:12px;
      margin-left: 15px;
      display: inline-block;
      margin-top: -5px;
      width: 60%;
    }

    p#filteredtime {
      font-family: arial;
      margin-right: 5px;
      display: initial;
      font-size: 10px;
      color: rgb(153, 153, 153);
      float: right;
      margin-top: initial;
    }

    p#time {
      text-align: right;
      margin: 20px 5px 0px 0px;
      font-size: 12px;
      color: rgb(153, 153, 153);
    }

    div.title {
      margin-left: auto;
      margin-right: auto;
      margin-bottom: -10px;
      margin-top: -5px;
      text-align: left;
      width: 60%;
      padding: 5px;
      font-size: 50px;
      color: rgb(255, 255, 255);
      font-family: fantasy;
      text-shadow: -2px -2px rgb(107, 107, 107),
                    2px -2px rgb(107, 107, 107),
                   -2px 2px rgb(107, 107, 107),
                    2px 2px rgb(107, 107, 107);
    }

    p#username {
      display: inline-block;
      font-family: tahoma;
      font-weight: bold;
      text-decoration: underline;
    }

    p#msg{
      display: inline-block;
      font-family: arial;
      font-size:14px;
    }

    .play {
      height: 0px;
      width: 0px;
      display: inline-block;
      margin-top: 5px;
      margin-left: 20px;
      border-top: 10px solid transparent;
      border-bottom: 10px solid transparent; 
      border-left:20px solid lime; 
    }

    .pause {
      height: 20px;
      width: 4px;
      display: inline-block;
      margin-top: 5px;
      margin-left: 20px;
      border-right:8px solid red; 
      border-left:8px solid red;
    }





    </style>
  </head>
  <body>

    <div class="title">
      Twittler
      <div class='pause'></div>
    </div>

    <p class="main"></p>


    <script>
      var getTimeStamp = function(x){
          var now = x['created_at'];
          //var timestamp = moment(now).format('LLL');
          var timestamp = moment(now).fromNow();

          return timestamp;
        };

      $(document).ready(function(){
        var $body = $('.main');
        
        var oldTweets = -1;

        var tweetInitialize = function(){
          var index = streams.home.length - 1;
          while(index >= 0){
            var tweet = streams.home[index];
            var timestamp = getTimeStamp(tweet);
            
            var tweetmsg = "<div class='message' id='"+index+"'>@<p id='username' class='"+tweet.user+"'>"+tweet.user+"</p>: <p id='msg'>"+tweet.message+"</p>";
            $body.append(tweetmsg);

            $('.message').last().append('<p id="time">'+timestamp+'</p>')


            index -= 1;
            oldTweets++
            $('.message').fadeIn('slow');
          }
        }

        tweetInitialize();
        
        var tweetIt = function(){
            var index = streams.home.length-1;
            if(index > oldTweets){
              for(var i = oldTweets+1; i<=index; i++){
                var tweet = streams.home[index];
                var timestamp = getTimeStamp(tweet);

                var tweetmsg = "<div class='message' id='"+index+"'>@<p id='username'>"+tweet.user+"</p>: <p id='msg'>"+tweet.message+"</p>";
                $body.prepend(tweetmsg);

                $('.message').first().append('<p id="time">'+timestamp+'</p>');

                index -= 1;
                oldTweets++;
              }
            }
            $('.message').first().show('slow');
            $('.main').find('.message').slice(10).fadeOut('slow',function(){
              $(this).remove();
            });
          };

        var tweetingIt = setInterval(tweetIt,200);

        $('.main').on('dblclick','.message', function(){
          $(this).fadeOut('slow',function(){
            $(this).remove();
          });
        });

        $('.main').on('dblclick','.filter', function(){
          $(this).fadeOut('slow',function(){
            $('div>div').removeClass('play');
            $('div>div').addClass('pause');
            tweetingIt = setInterval(tweetIt,200);
            $(this).remove();
          });
        });

        $('.title').on('click','.pause',function(){
          $(this).removeClass('pause');
          $(this).addClass('play');
          clearInterval(tweetingIt);
        });

        $('.title').on('click','.play',function(){
          $(this).removeClass('play');
          $(this).addClass('pause');
          $('.filter').fadeOut('slow',function(){
            $('.filter').remove();
          });
          tweetingIt = setInterval(tweetIt,200);
        });

        $('.main').on('click','#username',function(){
          $('div>div').removeClass('pause');
          $('div>div').addClass('play');
          clearInterval(tweetingIt);


          var username = $(this).text();
          var tweets = streams.users[username];


          $('.main').find('.message').fadeOut('slow');
          $('.main').prepend("<div class='filter'></div>");
          
          $('.filter').prepend('<p id="filteredname">@'+username+'\'s tweets:</p>');

          for (var i=tweets.length-1; i>=0;i--){
            var fulltime = moment(tweets[i].created_at).format('LLL');
            var timestamp = '<p id="filteredtime" class="'+fulltime+'">'+getTimeStamp(tweets[i])+'</p><br>';
            
            var messages = '<p id="filter">'+tweets[i].message+"</p>";
            $('.filter').append(messages + timestamp);
          }


          $('.filter').show('slow');

        });

        $('.main').on('mouseenter','#time', function(){
          var index = $(this).closest('.message').attr('id');
          var tweet = streams.home[index];
          var timestamp = moment(tweet.created_at).format('LLL');
          $(this).text(timestamp);
        });

        $('.main').on('mouseleave','#time', function(){
          var index = $(this).closest('.message').attr('id');
          var tweet = streams.home[index];
          var timestamp = getTimeStamp(tweet);
          $(this).text(timestamp);
        });

        $('.main').on('mouseenter','#filteredtime', function(){
          var timestamp = $(this).attr('class');
          $(this).text(timestamp);
        });

        $('.main').on('mouseleave','#filteredtime', function(){
          var timestamp = moment($(this).text()).fromNow();
          $(this).text(timestamp);
        });



      });

    </script>
  </body>
</html>
